# 재고 수불부 마감 절차

## 원칙
1. 재고수불부는 월별 마감
2. 재고수불부 구조
	* 기초 + 구매입고 - 출고 + 재고조정입고 - 재고조정출고 = 기말
	* 수량과 금액 병기
3. 출고 기준은 PA의 수취확인 일자
4. 구매입고 기준은 GMS의 검수확인 일자
5. 재고 단가 산정기준은 FIFO(First In First Out)

## 마감 절차

### 흐름도

```mermaid
graph TD
A(수불마감) --> Z[품목별 기초 수량 = AQ<br>품목별 기초 금액 = AP]
Z-->B[마감 시작일, 종료일 확정<br>시작일부터 종료일까지 = '마감기간']
B-->C[마감기간 센터코드별<br>구매입고 수량 합산 = BQ]
B-->X[재고조정입고의 반품, 교환<br>대상 품목 입고시 입력된<br>'기존주문번호'를<br>기준으로 기존주문번호<br>출고 품목과 수량이<br>반품, 교환으로 입고된<br>품목과 수량과 일치여부를 확인]
X-->Y[재고조정입고의 반품, 교환 발생으로<br>'기존주문번호'가 기재된<br>품목과 수량은<br>출고 및 재고조정입고<br>합산에서 제외*1]
Y-->D[마감기간 센터코드별<br>출고 수량 합산 = CQ<br><br>재고조정입고 품목에 기재된<br>'기존주문번호' 품목의 출고수량은<br>합산대상 아님]
Y-->E[마감기간 센터코드별<br>재고조정입고 = DQ 및 <br>재고조정출고 = EQ 수량 합산<br><br>재고조정입고 중 '기존주문번호'가 있는<br>품목의 수량은 합산대상 아님]
C-->K[품목별 구매입고 금액 합산 = BP]
D-->F[종료일 기준 품목별 수량 계산<br>FQ = AQ + BQ - CQ + DQ - EQ]
E-->F
F-->G[출고금액 및 기말재고 금액 계산]
```
*1) 반품, 교환되는 품목의 경우 재입고시 기존 주문번호를 기재하고 재고조정입고됨. 기존 출고 및 반품, 교환 입고 수량을 상계하여 중복출고를 제외함.

```mermaid
graph TD
A[출고금액 및 기말재고 금액 계산 #1]
B[출고금액 및 기말재고 금액 계산 #2]
C[품목별 기말재고 수량에<br>최근 입고 단가를 mapping하여<br>기말재고금액 계산]
D[FP = 기말재고 금액]
A-->C
C-->D

E[재고조정입고금액 = DP 은 금액 없음]
F[재고조정출고금액_공급사반품 = EP1<br>공급사반품은 마이너스 세금계산서<br>대상으로 금액 확정]
D-->E
E-->F

G[AP + BP - CP + DP - EP1 - EP2 = FP<br>AP, BP, DP=0, EP1, FP 확정<br>CP + EP2 = 출고금액 + 폐기금액은<br>역산하여 산정가능<br>CP+EP2는 평균단가로 계산]
F-->G

H[출고일자와 폐기일자 순서를 따라가며<br>FIFO에 따라 재고단가를 재계산하여<br>출고금액, 폐기금액을 계산]
B-->H
```